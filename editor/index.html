<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>RS Visual Product Finder EDITOR</title>
<link href="../css/reset.css" rel="stylesheet" />
<link href="css/fonts.css" rel="stylesheet" />
<link rel="stylesheet" href="http://code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
  
<!--<link href="../css/productfinder_editor.css" rel="stylesheet" />-->


  <style>
  
  .tabledescr{
	 font:Arial;
	 font-size:12px;
	 font-weight:bold;
	 padding:10px;
	 vertical-align:middle;
   }
   .icon{
		cursor:pointer;
		font-size:24px;
	}
  
  .hscircle {
    position: relative;
    top:-5px; 
    left:-7px;
    border-radius: 50%;
    width: 20px;
    height: 20px; 
    border: 3px solid #217aff;
    background-color: none;
    cursor:pointer;
   }
   
     .ui-state-highlight { height: 3em; line-height: 1.2em; }
  
  
  
  </style>


</head>

<body>v1.0

<div id="mainmenu">
  <ul>
    <li class="menuitem"><a href="#main-1">FILE</a></li>
    <li class="menuitem"><a href="#main-2">Static Text</a></li>
    <li class="menuitem"><a href="#main-3">Robotics</a></li>
    <li class="menuitem"><a href="#main-4">Conveyor Systems</a></li>
    <li class="menuitem"><a href="#main-5">Control Cabinet</a></li>
    <li class="menuitem"><a href="#main-6">Storage Tank</a></li>
  </ul>
  
  <!-- FILE MENU -->
  <div id="main-1">
    <div id="importXML">Import XML File<br/>
	    <input type="file" onchange="openFile(event);" Name="Load" />
    </div><br/><br/>
    <div id="exportXML">Export XML File<br/>
    	<button name="Export XML" id="btnExportXML">Export XML</button>
    </div><br/><br/>
    
    <div id="saveXML">
    	<button name="Save XML" id="btnSaveXML">Save</button>
     </div>
  </div>
  <!-- END FILE MENU -->
  
  <!-- STATIC COPY TEXT -->
  <div id="main-2">
  <table border="1" cellpadding="5" cellspacing="0">
	<thead>
		<tr>
			<td class="tabledescr">Name</td>
			<td width="20"></td>
            <td class="tabledescr">Current Text</td>
			
		</tr>
	</thead>
	<tbody>
		<tr>
			<td class="tabledescr">Title:</td>
			<td width="20"></td>
            <td><input type="text" id="cp_title" size="70"></td>
			
		</tr>
		<tr>
			<td class="tabledescr">Subtitle:</td>
            <td width="20"></td>
			<td><input type="text" id="cp_subtitle" size="70"></td>
			
		</tr>
		<tr>
			<td class="tabledescr">Button (Go)</td>
			<td width="20"></td>
            <td><input type="text" id="cp_btngo" size="20"></td>
			
		</tr>
		<tr>
		  <td class="tabledescr">Title (Choose...):</td>
		  <td></td>
		  <td><input type="text" id="cp_chooseyourselection" size="70"></td>
	    </tr>
		<tr>
		  <td class="tabledescr" nowrap>Title Copy (Our Service...)</td>
		  <td></td>
		  <td><input type="text" id="cp_titleourservice" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Copy 1 (Our Service....)</td>
		  <td></td>
		  <td><input type="text" id="cp_copyourservice1" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Copy 2 (Our Service....)</td>
		  <td></td>
		  <td><input type="text" id="cp_copyourservice2" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Copy 3 (Our Service....)</td>
		  <td></td>
		  <td><input type="text" id="cp_copyourservice3" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Copy 4 (Our Service....)</td>
		  <td></td>
		  <td><input type="text" id="cp_copyourservice4" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Copy 5 (Our Service....)</td>
		  <td></td>
		  <td><input type="text" id="cp_copyourservice5" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Copy 6 (Our Service....)</td>
		  <td></td>
		  <td><input type="text" id="cp_copyourservice6" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Copy 7 (Our Service....)</td>
		  <td></td>
		  <td><input type="text" id="cp_copyourservice7" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Button (Select)</td>
		  <td></td>
		  <td><input type="text" id="cp_btnselect" size="20"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Hotspot 1</td>
		  <td></td>
		  <td><input type="text" id="cp_hotspot1" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Hotspot 2</td>
		  <td></td>
		  <td><input type="text" id="cp_hotspot2" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Hotspot 3</td>
		  <td></td>
		  <td><input type="text" id="cp_hotspot3" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Hotspot 4</td>
		  <td></td>
		  <td><input type="text" id="cp_hotspot4" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Submenu 1</td>
		  <td></td>
		  <td><input type="text" id="cp_submenu1" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Submenu 2</td>
		  <td></td>
		  <td><input type="text" id="cp_submenu2" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Submenu 3</td>
		  <td></td>
		  <td><input type="text" id="cp_submenu3" size="70"></td>
	    </tr>
        <tr>
		  <td class="tabledescr">Submenu 4</td>
		  <td></td>
		  <td><input type="text" id="cp_submenu4" size="70"></td>
	    </tr>
	</tbody>
</table>
  </div>
<!-- END STATIC COPY TEXT -->
	

<!-- ROBOTICS -->
  <div id="main-3">
	<div id="submenurobotics" style="overflow:hidden">
      <ul>
        <li class="menuitem" ><a href="#subrob-1">Visual</a></li>
        <li class="menuitem"><a href="#subrob-2">Accessories</a></li>
        <li class="menuitem"><a href="#subrob-3">Test & Measurement</a></li>
        <li class="menuitem"><a href="#subrob-4">Tools</a></li>
        <li class="menuitem"><a href="#subrob-5">RS Pro</a></li>
      </ul>
      <div id="subrob-1" style="margin-left:20px;margin-top:20px;width:980px;height:550px;background:url(img/overlay_robotics.jpg) no-repeat; background-size:auto"><!--<img src="img/overlay_robotics.jpg" width="980" alt="overlay_robotics" style="opacity:0.6;"/>--></div>
      <div id="subrob-2"></div>
      <div id="subrob-3"></div>
      <div id="subrob-4"></div>
      <div id="subrob-5"></div>
     </div>
  </div>
<!-- END ROBOTICS -->

<!-- CONVEYOR SYSTEMS -->
  <div id="main-4">
    <div id="submenuconveyor" style="overflow:hidden">
      <ul>
        <li class="menuitem"><a href="#subconv-1">Visual</a></li>
        <li class="menuitem"><a href="#subconv-2">Accessories</a></li>
        <li class="menuitem"><a href="#subconv-3">Test & Measurement</a></li>
        <li class="menuitem"><a href="#subconv-4">Tools</a></li>
        <li class="menuitem"><a href="#subconv-5">RS Pro</a></li>
      </ul>
      <div id="subconv-1" style="margin-left:20px;margin-top:20px;width:980px;height:550px;background:url(img/overlay_conveyorsystems.jpg) no-repeat; background-size:auto"><!--<img src="img/overlay_conveyorsystems.jpg" width="980" alt="overlay_conveyorsystems" style="opacity:0.6;"/>--></div>
      <div id="subconv-2"></div>
      <div id="subconv-3"></div>
      <div id="subconv-4"></div>
      <div id="subconv-5"></div>
     </div>
  </div>
  
<!-- END CONVEYOR SYSTEMS -->

<!-- CONTROL CABINET -->
<div id="main-5">
 	<div id="submenucontrol" style="overflow:hidden">
      <ul>
        <li class="menuitem"><a href="#subcab-1">Visual</a></li>
        <li class="menuitem"><a href="#subcab-2">Accessories</a></li>
        <li class="menuitem"><a href="#subcab-3">Test & Measurement</a></li>
        <li class="menuitem"><a href="#subcab-4">Tools</a></li>
        <li class="menuitem"><a href="#subcab-5">RS Pro</a></li>
      </ul>
      <div id="subcab-1" style="margin-left:20px;margin-top:20px;width:980px;height:550px;background:url(img/overlay_controlcabinet.jpg) no-repeat; background-size:auto"><!--<img src="img/overlay_controlcabinet.jpg" width="980" alt="overlay_conveyorsystems" style="opacity:0.6;"/>--></div>
      <div id="subcab-2"></div>
      <div id="subcab-3"></div>
      <div id="subcab-4"></div>
      <div id="subcab-5"></div>
     </div>
    
  </div>
<!-- END CONTROL CABINET -->

<!-- STORAGE TANK -->
<div id="main-6">
	<div id="submenustorage" style="overflow:hidden">
      <ul>
        <li class="menuitem"><a href="#substor-1">Visual</a></li>
        <li class="menuitem"><a href="#substor-2">Accessories</a></li>
        <li class="menuitem"><a href="#substor-3">Test & Measurement</a></li>
        <li class="menuitem"><a href="#substor-4">Tools</a></li>
        <li class="menuitem"><a href="#substor-5">RS Pro</a></li>
      </ul>
      <div id="substor-1" style="margin-left:20px;margin-top:20px;width:980px;height:550px;background:url(img/overlay_storagetank.jpg) no-repeat; background-size:auto"><!--<img src="img/overlay_storagetank.jpg" width="980" alt="overlay_conveyorsystems" style="opacity:0.6;"/>--></div>
      <div id="substor-2"></div>
      <div id="substor-3"></div>
      <div id="substor-4"></div>
      <div id="substor-5"></div>
     </div>
    
</div>
<!-- END STORAGE TANK -->

</div>
<div id="infowindoweditor"></div>




<!--CDN link for  TweenMax-->

<!--CDN links for TweenLite, CSSPlugin, and EasePack-->
<script src="../js/gsap/plugins/CSSPlugin.min.js" type="text/javascript"></script>
<script src="../js/gsap/easing/EasePack.min.js" type="text/javascript"></script>
<!--<script src="js/gsap/TweenLite.min.js"></script>-->
<script src="../js/gsap/TweenMax.min.js" type="text/javascript"></script>
<!-- SITE LEVEL SCRIPTS -->
<script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
<script src="js/FileSaver.min.js" type="text/javascript"></script>

<!-- PAGE LEVEL SCRIPTS -->
<!--<script src="js/productfinder.js" type="text/javascript"></script>-->
<script type="text/javascript">
   $( function() {
    $( "#mainmenu" ).tabs();
	$( "#submenurobotics" ).tabs();
	$( "#submenuconveyor" ).tabs();
	$( "#submenucontrol" ).tabs();
	$( "#submenustorage" ).tabs();
   
  } );

  window.onload = function(){
	console.log("on LOAD....");
	loadLocal();
	
	$("#btnSaveXML").click(function(){
		console.log("save to local storage");
		
		
		var _XML = generateXML();
		//console.log(_XML);
		saveLocal(_XML);
		
	});
	
	
	$("#btnExportXML").click(function(){
		console.log("Exporting XML");
		var _XML = generateXML();
		var blob = new Blob([_XML], {type: "javascript/plain;charset=utf-8"});
		saveAs(blob, "config.js");
	
	});
	
	
	$('.menuitem').click(function(){
		hideinfowindow();
		//$("#infowindoweditor").css("left","-999px");	
	});
	
	/*$("#infowindoweditor").on("mouseleave",function(){
		$(this).css("left","-999px");
		
	});*/
	
	
  }
  
</script>
<script type="text/javascript">

function hideinfowindow(){
	$("#infowindoweditor").css("left","-999px");	
}

 var openFile = function(event) {
    var input = event.target;

    var reader = new FileReader();
    reader.onload = function(){
      var XML = reader.result;
      parseXML(XML);
	  console.log(XML);
	  //console.log(reader.result.substring(0, 200));
    };
    reader.readAsText(input.files[0]);
  };


var xmlConf, xmlRobotics, xmlConveyor, xmlControlCab, xmlStorageTank;


function generateXML(){
	
	
	var _xml = "";
	_xml += '<?xml version="1.0" encoding="utf-8"?>\n';
	_xml += '<page>\n';
	_xml += '<configuration>\n';
	_xml += '	<cp_title><![CDATA['+$('#cp_title').val()+']]></cp_title>\n';  
	_xml += '	<cp_subtitle><![CDATA['+$('#cp_subtitle').val()+']]></cp_subtitle>\n'; 
	_xml += '	<cp_btngo><![CDATA['+$('#cp_btngo').val()+']]></cp_btngo>\n'; 
	_xml += '	<cp_chooseyourselection><![CDATA['+$('#cp_chooseyourselection').val()+']]></cp_chooseyourselection>\n';
	_xml += '	<cp_titleourservice><![CDATA['+$('#cp_titleourservice').val()+']]></cp_titleourservice>\n'; 
	_xml += '	<cp_copyourservice1><![CDATA['+$('#cp_copyourservice1').val()+']]></cp_copyourservice1>\n'; 
	_xml += '	<cp_copyourservice2><![CDATA['+$('#cp_copyourservice2').val()+']]></cp_copyourservice2>\n'; 
	_xml += '	<cp_copyourservice3><![CDATA['+$('#cp_copyourservice3').val()+']]></cp_copyourservice3>\n'; 
	_xml += '	<cp_copyourservice4><![CDATA['+$('#cp_copyourservice4').val()+']]></cp_copyourservice4>\n'; 
	_xml += '	<cp_copyourservice5><![CDATA['+$('#cp_copyourservice5').val()+']]></cp_copyourservice5>\n'; 
	_xml += '	<cp_copyourservice6><![CDATA['+$('#cp_copyourservice6').val()+']]></cp_copyourservice6>\n'; 
	_xml += '	<cp_copyourservice7><![CDATA['+$('#cp_copyourservice7').val()+']]></cp_copyourservice7>\n'; 
	_xml += '	<cp_btnselect><![CDATA['+$('#cp_btnselect').val()+']]></cp_btnselect>\n'; 
	_xml += '	<cp_hotspot1><![CDATA['+$('#cp_hotspot1').val()+']]></cp_hotspot1>\n'; 
	_xml += '	<cp_hotspot2><![CDATA['+$('#cp_hotspot2').val()+']]></cp_hotspot2>\n'; 
	_xml += '	<cp_hotspot3><![CDATA['+$('#cp_hotspot3').val()+']]></cp_hotspot3>\n'; 
	_xml += '	<cp_hotspot4><![CDATA['+$('#cp_hotspot4').val()+']]></cp_hotspot4>\n'; 
	_xml += '	<cp_submenu1><![CDATA['+$('#cp_submenu1').val()+']]></cp_submenu1>\n'; 
	_xml += '	<cp_submenu2><![CDATA['+$('#cp_submenu2').val()+']]></cp_submenu2>\n'; 
	_xml += '	<cp_submenu3><![CDATA['+$('#cp_submenu3').val()+']]></cp_submenu3>\n'; 
	_xml += '	<cp_submenu4><![CDATA['+$('#cp_submenu4').val()+']]></cp_submenu4>\n'; 
	_xml += '</configuration>\n'; 
	
	
	_xml += '<robotics>\n';
	_xml += '<hotspots>\n';
	/* HOTSPOT CONTENT */
	_xml += parseOutHS(arrhsROB);
	_xml += '</hotspots>\n';
	_xml += '<accessories>\n';
	_xml += parseOut(arracROB);
	_xml += '</accessories>\n';
	_xml += '<testandmeasurment>\n';
	_xml += parseOut(arrteROB);
	_xml += '</testandmeasurment>\n';
	_xml += '<tools>\n';
	_xml += parseOut(arrtoROB);
	_xml += '</tools>\n';
	_xml += '<rspro>\n';
	_xml += parseOut(arrrsROB);
	_xml += '</rspro>\n';
	_xml += '</robotics>\n';
	
	_xml += '<conveyorsystems>\n';
	_xml += '<hotspots>\n';
	/* HOTSPOT CONTENT */
	_xml += parseOutHS(arrhsCON);
	_xml += '</hotspots>\n';
	_xml += '<accessories>\n';
	_xml += parseOut(arracCON);
	_xml += '</accessories>\n';
	_xml += '<testandmeasurment>\n';
	_xml += parseOut(arrteCON);
	_xml += '</testandmeasurment>\n';
	_xml += '<tools>\n';
	_xml += parseOut(arrtoCON);
	_xml += '</tools>\n';
	_xml += '<rspro>\n';
	_xml += parseOut(arrrsCON);
	_xml += '</rspro>\n';
	_xml += '</conveyorsystems>\n';
	
	_xml += '<storagetank>\n';
	_xml += '<hotspots>\n';
	/* HOTSPOT CONTENT */
	_xml += parseOutHS(arrhsSTO);
	_xml += '</hotspots>\n';
	_xml += '<accessories>\n';
	_xml += parseOut(arracSTO);
	_xml += '</accessories>\n';
	_xml += '<testandmeasurment>\n';
	_xml += parseOut(arrteSTO);
	_xml += '</testandmeasurment>\n';
	_xml += '<tools>\n';
	_xml += parseOut(arrtoSTO);
	_xml += '</tools>\n';
	_xml += '<rspro>\n';
	_xml += parseOut(arrrsSTO);
	_xml += '</rspro>\n';
	_xml += '</storagetank>\n';
	
	_xml += '<controlcabinet>\n';
	_xml += '<hotspots>\n';
	/* HOTSPOT CONTENT */
	_xml += parseOutHS(arrhsCAB);
	_xml += '</hotspots>\n';
	_xml += '<accessories>\n';
	_xml += parseOut(arracCAB);
	_xml += '</accessories>\n';
	_xml += '<testandmeasurment>\n';
	_xml += parseOut(arrteCAB);
	_xml += '</testandmeasurment>\n';
	_xml += '<tools>\n';
	_xml += parseOut(arrtoCAB);
	_xml += '</tools>\n';
	_xml += '<rspro>\n';
	_xml += parseOut(arrrsCAB);
	_xml += '</rspro>\n';
	_xml += '</controlcabinet>\n';
	
	
	_xml += '</page>';
	
	return _xml;
}

function parseOutHS(_array){
	var _outHTML = '';
	console.log(_array);
	for (var i=0;i<_array.length;i++){
		_outHTML +='	<entry>\n';
		_outHTML += '		<idname><![CDATA['+_array[i].theID+']]></idname>\n';
		_outHTML += '		<position>\n';
		_outHTML += '			<left><![CDATA['+_array[i].theLeft+']]></left>\n';
		_outHTML += '			<top><![CDATA['+_array[i].theTop+']]></top>\n';
		_outHTML += '		</position>\n';
		_outHTML += '		<items>\n';
		for (var j=0;j<_array[i].theItems.length;j++){
			_outHTML += '			<item>\n';
			_outHTML += '				<name><![CDATA['+_array[i].theItems[j].itemname+']]></name>\n';
			_outHTML += '				<iconsrc><![CDATA['+_array[i].theItems[j].iconsrc+']]></iconsrc>\n';
			_outHTML += '				<link><![CDATA['+_array[i].theItems[j].itemlink+']]></link>\n';
			_outHTML += '				<description><![CDATA['+_array[i].theItems[j].itemdescr+']]></description>\n';
			_outHTML += '			</item>\n';
		}
		_outHTML += '		</items>\n';
		_outHTML +='	</entry>\n';
	}
	
	
	
	return _outHTML;
}



function parseOut(_array){
	var _outHTML = '';
	
	for (var i=0;i<_array.length;i++){
		_outHTML +='	<entry>\n';	
		_outHTML +='		<name><![CDATA['+_array[i].theName+']]></name>\n';
		_outHTML +='		<link><![CDATA['+_array[i].theLink+']]></link>\n';
		_outHTML +='		<description><![CDATA['+_array[i].theDescr+']]></description>\n';
		_outHTML +='	</entry>\n';
	}
	
	return _outHTML	
}


function parseXML(_XML){
	//console.log(_XML);

	  	xmlDoc = $.parseXML( _XML ),
  		$xml = $( xmlDoc ),
  		xmlConf 			= $xml.find( "configuration" );
		xmlRobotics 		= $xml.find( "robotics" );
		xmlConveyor 		= $xml.find( "conveyorsystems" );
		xmlControlCab 	= $xml.find( "controlcabinet" );
		xmlStorageTank 	= $xml.find( "storagetank" );
		
		
	$("#cp_title").val($xml.find("cp_title").text());
	$("#cp_subtitle").val($xml.find("cp_subtitle").text());
	$("#cp_btngo").val($xml.find("cp_btngo").text());
	$("#cp_chooseyourselection").val($xml.find("cp_chooseyourselection").text());
	$("#cp_titleourservice").val($xml.find("cp_titleourservice").text());
	$("#cp_copyourservice1").val($xml.find("cp_copyourservice1").text());
	$("#cp_copyourservice2").val($xml.find("cp_copyourservice2").text());
	$("#cp_copyourservice3").val($xml.find("cp_copyourservice3").text());
	$("#cp_copyourservice4").val($xml.find("cp_copyourservice4").text());
	$("#cp_copyourservice5").val($xml.find("cp_copyourservice5").text());
	$("#cp_copyourservice6").val($xml.find("cp_copyourservice6").text());
	$("#cp_copyourservice7").val($xml.find("cp_copyourservice7").text());
	$("#cp_btnselect").val($xml.find("cp_btnselect").text());
	
	$("#cp_submenu1").val($xml.find("cp_submenu1").text());
	$("#cp_submenu2").val($xml.find("cp_submenu2").text());
	$("#cp_submenu3").val($xml.find("cp_submenu3").text());
	$("#cp_submenu4").val($xml.find("cp_submenu4").text());
	
	$("#cp_hotspot1").val($xml.find("cp_hotspot1").text());
	$("#cp_hotspot2").val($xml.find("cp_hotspot2").text());
	$("#cp_hotspot3").val($xml.find("cp_hotspot3").text());
	$("#cp_hotspot4").val($xml.find("cp_hotspot4").text());
	
		
		
		//console.log(_XML);
		
		generateArrays();
		
		
		saveLocal(_XML);
}

var arrhsROB, arracROB, arrteROB, arrtoROB, arrrsROB  = [];
var arrhsCON, arracCON, arrteCON, arrtoCON, arrrsCON  = [];
var arrhsCAB, arracCAB, arrteCAB, arrtoCAB, arrrsCAB  = [];
var arrhsSTO, arracSTO, arrteSTO, arrtoSTO, arrrsSTO  = [];


function genArr(_input){
	// GENERATING a simple OBJECT ARRAY AND RETURNING  IT 
	var _output = [];
	for (var i=0;i<_input.length;i++){
		var _tName  = $(_input[i]).find("name").text();
		var _tLink  = $(_input[i]).find("link").text();
		var _tDescr = $(_input[i]).find("descr").text();
		_output.push({theName:_tName,theLink:_tLink,theDescr:_tDescr});	
	}
	return _output	
}

function genArrHS(_input){
	var _output=[];
	
	for (var i=0;i<_input.length;i++){
		var _theID  = $(_input[i]).find("idname").text();
		var _posLeft = $(_input[i]).find("position").find("left").text();
		var _posTop  = $(_input[i]).find("position").find("top").text();
		var _tArray =  $(_input[i]).find("item");
		var _items = [];
		
		for (var j=0;j<_tArray.length;j++){
				var _itemname = $(_tArray[j]).find("name").text();
				var _itemlink = $(_tArray[j]).find("link").text();
				var _itemdescr = $(_tArray[j]).find("description").text();
				var _iconsrc = $(_tArray[j]).find("iconsrc").text();
				
				_items.push({itemname:_itemname,itemlink:_itemlink,itemdescr:_itemdescr,iconsrc:_iconsrc});
		}
		
		_output.push({theID:_theID,theLeft:_posLeft,theTop:_posTop,theItems:_items});
	}
	
	
	return _output
}

function deleteItem(_target){
		console.log($(_target).attr("id"));
		var _arrayName = $(_target).attr("id").split("_")[1];
		var _idName = $(_target).attr("id").split("_")[2];
		var _theIndex = $(_target).attr("id").split("_")[3];
		var _left = $(_target).attr("id").split("_")[4];
		var _top = $(_target).attr("id").split("_")[5];
		var _spliceArray = _itemArray.splice(_theIndex,1);
		generateHTML(_idName,_left,_top,_itemArray,_arrayName);
}
function newItem(_target){
		console.log($(_target).attr("id"));
		var _arrayName = $(_target).attr("id").split("_")[1];
		var _idName = $(_target).attr("id").split("_")[2];
		var _left = $(_target).attr("id").split("_")[3];
		var _top = $(_target).attr("id").split("_")[4];	
		
		if (_itemArray.length <3) _itemArray.unshift({itemname:'',itemlink:'',itemdescr:'',iconsrc:''});
		
		generateHTML(_idName,_left,_top,_itemArray,_arrayName);
}

function saveInfo(_target){
		console.log($(_target).attr("id"));
		var _theArray = eval($(_target).attr("id").split("_")[1]);
		var _idName = $(_target).attr("id").split("_")[2];
		
		_tArrayName = [];
		_tArrayValue = [];
		_tArrayIcon = [];
		
		_itemArray.length = 0;

		 
		
		$("#list"+_idName).find(".theName").each(function(){
			_tArrayName.push($(this).val());
			console.log($(this).val());
		});
		$("#list"+_idName).find(".theValue").each(function(){
			_tArrayValue.push($(this).val());
			//console.log($(this).val());
		});
		
		$("#list"+_idName).find(".theIcon").each(function(){
			_tArrayIcon.push($(this).val());
			//console.log($(this).val());
		});
		
		for (var i=0;i<_tArrayName.length;i++){
			_itemArray.push({itemname:_tArrayName[i],itemlink:_tArrayValue[i],iconsrc:_tArrayIcon[i],itemdescr:''});		
		}
		
		//_theArray = eval(_theArrayName);
		
		for (i=0;i<_theArray.length;i++){
			//console.log(_theArray[i].theID);
			if (String(_theArray[i].theID) == String(_idName)){
				
				console.log($(_theArray[i].theItems));
				console.log(_itemArray);
				_theArray[i].theItems.length = 0;
				
				for (var j=0;j<_itemArray.length;j++){
					_theArray[i].theItems.push(_itemArray[j]);	
				}
				
				break;
			}
		}
		
		
		/*var _result = $.grep(_theArray, function(e){ return e.theID == _idName; });
		var _items = _result[0].theItems;
		
		//console.log(_items);
		
		var _newXML = '';
		_newXML 	+='<items>\n';
		
		for (i=0;i<_itemArray.length;i++){
			var _itemname 	= _itemArray[i].itemname;
			var _itemlink 	= _itemArray[i].itemlink;
			var _itemdescr 	= _itemArray[i].itemdescr;
			var _iconsrc 	= _itemArray[i].iconsrc;
			
			_newXML 	+='<item>\n';
			_newXML 	+='		<name><![CDATA[aa'+_itemname+']]></name>\n';
			_newXML 	+='		<iconsrc><![CDATA['+_iconsrc+']]></iconsrc>\n';
			_newXML 	+='		<link><![CDATA['+_itemlink+']]></link>\n';
			_newXML 	+='		<description><![CDATA['+_itemdescr+']]></description>\n';
			_newXML 	+='</item>\n';
		}
		_newXML 	+='</items>\n';
		
		
		console.log("***********************");
		for (i=0;i<_theArray.length;i++){
			//console.log(_theArray[i].theID);
			if (String(_theArray[i].theID) == String(_idName)){
				
				console.log($(_theArray[i].theItems));
				console.log(_itemArray);
				_theArray[i].theItems.length = 0;
				
				for (var j=0;j<_itemArray.length;j++){
					_theArray[i].theItems.push(_itemArray[j]);	
				}
				
				break;
			}
		}
		*/
				
}





function generateHTML(_idName,_left,_top,_itemArray,_theArrayName){
			var _tHTML = ''
	       	_tHTML += '<div align="right"><button onclick="newItem(this)" id="btnNew_'+_theArrayName+'_'+_idName+'_'+_left+'_'+_top+'"><div class="btnblue icon-rs_79-add-list icon"></div> New Item</button>';
			_tHTML += '<button onclick="saveInfo(this);" id="btnSave_'+_theArrayName+'_'+_idName+'"><div class="btnblue icon-rs_48-save icon"></div> Save</button>';
			_tHTML += '<button onclick="hideinfowindow();" id="btnCloseInfoWindow"><div class="btnblue icon-rs_10-box-cross icon"></div> Close</button></div>';
			_tHTML += '<ul id="list'+_idName+'">';
		
		
		for (var i=0;i<_itemArray.length;i++){
			
			var _itemname 	= _itemArray[i].itemname;
			var _itemlink 	= _itemArray[i].itemlink;
			var _itemdescr 	= _itemArray[i].itemdescr;
			var _iconsrc 	= _itemArray[i].iconsrc;
			
			_tHTML +='<li class="ui-state-default">';
			_tHTML +='<table><tr>';
			_tHTML +='<td valign="top" class="tabledescr"><div id="" class="btnblue icon-rs_3-arrange-list icon"></div></td>';
			_tHTML +='<td valign="top" class="tabledescr">';
			_tHTML +='	<input placeholder="Enter a name" type="text" class="theName" id="fName_'+_theArrayName+'_'+_idName+'" value="'+_itemname+'" SIZE="40" /><br/>';
			_tHTML +='   <input placeholder="Enter File ref" type="text" class="theIcon" id="fIcon_'+_theArrayName+'_'+_idName+'" value="'+_iconsrc+'" SIZE="40" />';
			_tHTML +='</td>';
			_tHTML +='<td><div style="margin-top:10px;width:40px;height:40px;background-color:#ffffff;border:solid 1px #ebebeb"><img src="../images/png/'+_iconsrc+'" width="40" /></div></td>';
			_tHTML +='</tr>'; 	
			_tHTML +='<tr><td></td><td valign="top" class="tabledescr"><textarea placeholder="Enter the link" class="theValue"  id="fLink_'+_theArrayName+'_'+_idName+'" value="'+_itemlink+'" cols="40" rows="2">'+_itemlink+'</textarea></td>';
			_tHTML +='<td class="tabledescr"><div id="btndelete_'+_theArrayName+'_'+_idName+'_'+i+'_'+_left+'_'+_top+'" class="btnblue icon-rs_24-delete icon" onclick="deleteItem(this);"></div></td>';
		
			_tHTML +='</tr></table>';
			_tHTML +='</li>';	
		
		}
				
		_tHTML += '</ul>';
		
		$('#infowindoweditor').html(_tHTML);
		 $( "#list"+_idName ).sortable({
      placeholder: "ui-state-highlight"
    });
	
	
	 $( "#list"+_idName ).on( "sortstop", function( event, ui ) {
		console.log("SAVE");
		_tArrayName = [];
		_tArrayValue = [];
		_tArrayIcon = [];
		
		_itemArray.length = 0;

		 
		
		$("#list"+_idName).find(".theName").each(function(){
			_tArrayName.push($(this).val());
			console.log($(this).val());
		});
		$("#list"+_idName).find(".theValue").each(function(){
			_tArrayValue.push($(this).val());
			//console.log($(this).val());
		});
		
		$("#list"+_idName).find(".theIcon").each(function(){
			_tArrayIcon.push($(this).val());
			//console.log($(this).val());
		});
		
		for (var i=0;i<_tArrayName.length;i++){
			_itemArray.push({itemname:_tArrayName[i],itemlink:_tArrayValue[i],iconsrc:_tArrayIcon[i],itemdescr:''});		
		}
		
		_theArray = eval(_theArrayName);
		
		for (i=0;i<_theArray.length;i++){
			//console.log(_theArray[i].theID);
			if (String(_theArray[i].theID) == String(_idName)){
				
				console.log($(_theArray[i].theItems));
				console.log(_itemArray);
				_theArray[i].theItems.length = 0;
				
				for (var j=0;j<_itemArray.length;j++){
					_theArray[i].theItems.push(_itemArray[j]);	
				}
				
				break;
			}
		}
		
		console.log(_itemArray);
		
		
	} );
	
	
		$('#infowindoweditor').css({
			"width":"450px",
			"height":"auto",
			"background-color":"#ebebeb",
			"border":"solid 1px #666666",
			"position":"absolute",
			"left":_left+"px",
			"top":_top+"px"
		});
	
	
	
	
}

var _itemArray = [];

function showData(_target){
		//console.log($(_target).data("xmldata"));
		var _theArray = eval($(_target).attr("id").split("_")[1]);
		var _theArrayName = $(_target).attr("id").split("_")[1];
		var _idName = $(_target).attr("id").split("_")[2];
		
		// FIND THE OBJECT IN THE ARRAY WIDTH THE RIGHT IDNAME
		var _result = $.grep(_theArray, function(e){ return e.theID == _idName; });
		console.log(_result);
		var _items = _result[0].theItems;
		//console.log(_items);
		_itemArray.length = 0;
		
		for (var i=0;i<_items.length;i++){
			/*var _itemname 	= $(_items[i]).find("name").text();
			var _itemlink 	= $(_items[i]).find("link").text();
			var _itemdescr 	= $(_items[i]).find("description").text();
			var _itemicon 	= $(_items[i]).find("iconsrc").text();	
			_itemArray.push({itemname:_itemname,itemlink:_itemlink,itemdescr:_itemdescr,itemicon:_itemicon});*/
			_itemArray.push(_items[i]);
		}
		
		//console.log(_itemArray);
		
		
		var _left = parseInt(_result[0].theLeft) + 55;
		var _top = parseInt(_result[0].theTop) + 138;
		if (_left>620) _left-=460;
		
		generateHTML(_idName,_left,_top,_itemArray,_theArrayName);
		
		
		
		/*console.log(_theArrayName);
		console.log(_items);
		console.log(_items.context.innerHTML);*/
}

var offsetLeft = 15;
var offsetTop = 58;

function generateHotspots(_source,_target,_arrayname){
	_tHTML ='';
	for (var i=0;i<_source.length;i++){
		var _idName = _source[i].theID;
		var _left = parseInt(_source[i].theLeft)+offsetLeft;
		var _top = parseInt(_source[i].theTop)+offsetTop;	
		var _data = _source[i].theItems;
		
		_tHTML += '<div onclick="showData(this);" class="detHS" id="hs_'+_arrayname+'_'+_idName+'" style="position:absolute;left:'+_left+'px;top:'+_top+'px;">';
		_tHTML += '   <div class="hscircle"></div>';
		_tHTML += '</div>';
		
			
	}
	
	_target.html(_tHTML);
}





function generateArrays(){
	console.log("GENERATE ARRAYS");
	/* ROBOTICS */
	//console.log(xmlRobotics);
	arrhsROB = genArrHS(xmlRobotics.find("hotspots").find("entry"));
	arracROB = genArr(xmlRobotics.find("accessories").find("entry"));
	arrteROB = genArr(xmlRobotics.find("testandmeasurment").find("entry"));
	arrtoROB = genArr(xmlRobotics.find("tools").find("entry"));
	arrrsROB = genArr(xmlRobotics.find("rspro").find("entry"));
	
	
	
	
	
	console.log(arrhsROB);
	
	//console.log(arr_rsrob);
	/* ROBOTICS END */
	
	/* CONVEYOR SYSTEMS */
	arrhsCON = genArrHS(xmlConveyor.find("hotspots").find("entry"));
	arracCON = genArr(xmlConveyor.find("accessories").find("entry"));
	arrteCON = genArr(xmlConveyor.find("testandmeasurment").find("entry"));
	arrtoCON = genArr(xmlConveyor.find("tools").find("entry"));
	arrrsCON = genArr(xmlConveyor.find("rspro").find("entry"));
	
	/* CONVEYOR SYSTEMS END */
	
	/* CONTROL CABINET */
	arrhsCAB = genArrHS(xmlControlCab.find("hotspots").find("entry"));
	arracCAB = genArr(xmlControlCab.find("accessories").find("entry"));
	arrteCAB = genArr(xmlControlCab.find("testandmeasurment").find("entry"));
	arrtoCAB = genArr(xmlControlCab.find("tools").find("entry"));
	arrrsCAB = genArr(xmlControlCab.find("rspro").find("entry"));
	
	/* CONTROL CABINET END */
	
	/* STORAGE TANK */
	arrhsSTO = genArrHS(xmlStorageTank.find("hotspots").find("entry"));
	arracSTO = genArr(xmlStorageTank.find("accessories").find("entry"));
	arrteSTO = genArr(xmlStorageTank.find("testandmeasurment").find("entry"));
	arrtoSTO = genArr(xmlStorageTank.find("tools").find("entry"));
	arrrsSTO = genArr(xmlStorageTank.find("rspro").find("entry"));
	
	/*  STORAGE TANK END */
	
	generateAllEntries();
	generateHotspots(arrhsROB,$('#subrob-1'),"arrhsROB");
	generateHotspots(arrhsCON,$('#subconv-1'),"arrhsCON");
	generateHotspots(arrhsCAB,$('#subcab-1'),"arrhsCAB");
	generateHotspots(arrhsSTO,$('#substor-1'),"arrhsSTO");
	
}

function generateAllEntries(){
	
	generateEntries(arracROB,$('#subrob-2'),"arracROB");
	generateEntries(arrteROB,$('#subrob-3'),"arrteROB");
	generateEntries(arrtoROB,$('#subrob-4'),"arrtoROB");
	generateEntries(arrrsROB,$('#subrob-5'),"arrrsROB");
	
	generateEntries(arracCON,$('#subconv-2'),"arracCON");
	generateEntries(arrteCON,$('#subconv-3'),"arrteCON");
	generateEntries(arrtoCON,$('#subconv-4'),"arrtoCON");
	generateEntries(arrrsCON,$('#subconv-5'),"arrrsCON");
	
	generateEntries(arracCAB,$('#subcab-2'),"arracCAB");
	generateEntries(arrteCAB,$('#subcab-3'),"arrteCAB");
	generateEntries(arrtoCAB,$('#subcab-4'),"arrtoCAB");
	generateEntries(arrrsCAB,$('#subcab-5'),"arrrsCAB");
	
	generateEntries(arracSTO,$('#substor-2'),"arracSTO");
	generateEntries(arrteSTO,$('#substor-3'),"arrteSTO");
	generateEntries(arrtoSTO,$('#substor-4'),"arrtoSTO");
	generateEntries(arrrsSTO,$('#substor-5'),"arrrsSTO");
}

function deleteEntry(_target){
	//alert($(_target).attr("id"));
	var _theArray = eval($(_target).attr("id").split("_")[1]);
	var _theIndex = $(_target).attr("id").split("_")[2];
	//console.log(_theArray);
	var _spliceArray = _theArray.splice(_theIndex, 1);
	//console.log(_spliceArray);
	//console.log(_theArray);
	generateAllEntries();
}
function newEntry(_target){
	var _theArray = eval($(_target).attr("id").split("_")[1]);
	_theArray.unshift({theName:'',theLink:'',theDescr:''});
	generateAllEntries();	
}


function saveEntry(_target){
	console.log("SAVE CHANGE onchange:" + $(_target).attr("id"));	
		_listname =  $(_target).attr("id").split("_")[1]; 
		_tArrayName = [];
		_tArrayValue = [];
		_tNewArray = eval(_listname) ;
		_tNewArray.length = 0;
		 
		//console.log(_listname);	
		$("#"+_listname).find(".theName").each(function(){
			_tArrayName.push($(this).val());
			//console.log($(this).val());
		});
		$("#"+_listname).find(".theValue").each(function(){
			_tArrayValue.push($(this).val());
			//console.log($(this).val());
		});
		
		for (var i=0;i<_tArrayName.length;i++){
			_tNewArray.push({theName:_tArrayName[i],theLink:_tArrayValue[i],theDescr:''});		
		}
		
		console.log(eval(_listname));
		console.log(_tNewArray);
	
}



function generateEntries(_source,_target,_listname){
	/* ROBOTICS */
	_tHTML = '';
	_tHTML += '<div align="right"><button onclick="newEntry(this)" id="btnNew_'+_listname+'"><div class="btnblue icon-rs_79-add-list icon"></div> New Item</button></div>';
	_tHTML += '<ul id="'+_listname+'">';
	
	for (var i=0;i<_source.length;i++){
		/*var _tName 	= $(arr_acrob[i]).find("name").text();
		var _tLink 	= $(arr_acrob[i]).find("link").text();
		var _tDesc	= $(arr_acrob[i]).find("description").text();*/
		_tHTML +='<li class="ui-state-default">';
		_tHTML +='<table><tr>';
		_tHTML +='<td valign="top" class="tabledescr"><div id="btndrag_'+_listname+'_'+i+'" class="btnblue icon-rs_3-arrange-list icon"></div></td>';
		_tHTML +='<td valign="top" class="tabledescr"><input placeholder="Enter a name" type="text" onChange="saveEntry(this);" class="theName" id="fName_'+_listname+'_'+i+'" value="'+_source[i].theName+'" SIZE="40" /></td>'; 	
		_tHTML +='<td valign="top" class="tabledescr"><textarea placeholder="Enter the link" onChange="saveEntry(this);" class="theValue"  id="fLink_'+_listname+'_'+i+'" value="'+_source[i].theLink+'" cols="70" rows="2">'+_source[i].theLink+'</textarea></td>';
		_tHTML +='<td class="tabledescr"><div id="btndel_'+_listname+'_'+i+'" class="btnblue icon-rs_24-delete icon" onclick="deleteEntry(this);"></div></td>';
		//_tHTML +='<td class="tabledescr"><input type="text" id="f_link_accrob'+i+'" value="'+_source[i].theLink+'" SIZE="120" /></td>'; 	
		//_tHTML +='<td valign="top" class="tabledescr"><input type="text" id="f_desc_accrob'+i+'" value="'+_source[i].theDescr+'" SIZE="40" /></td>'; 	
		_tHTML +='</tr></table>';
		_tHTML +='</li>';	
	}
	_tHTML += '</ul>';
	_target.html(_tHTML);
	
	
	/*$('.theValue').on("focusout",function(){
		console.log("SAVE CHANGE 45678");	
		_tArrayName = [];
		_tArrayValue = [];
		_tNewArray = eval(_listname) ;
		_tNewArray.length = 0;
		 
		//console.log(_listname);	
		$("#"+_listname).find(".theName").each(function(){
			_tArrayName.push($(this).val());
			//console.log($(this).val());
		});
		$("#"+_listname).find(".theValue").each(function(){
			_tArrayValue.push($(this).val());
			//console.log($(this).val());
		});
		
		for (var i=0;i<_tArrayName.length;i++){
			_tNewArray.push({theName:_tArrayName[i],theLink:_tArrayValue[i],theDescr:''});		
		}
		
		console.log(eval(_listname));
		console.log(_tNewArray);
		
		
	});*/
	
	/*$('.theName').on("change",function(){
		console.log("SAVE CHANGE 1234");	
		
		_tArrayName = [];
		_tArrayValue = [];
		_tNewArray = eval(_listname) ;
		_tNewArray.length = 0;
		 
		//console.log(_listname);	
		$("#"+_listname).find(".theName").each(function(){
			_tArrayName.push($(this).val());
			//console.log($(this).val());
		});
		$("#"+_listname).find(".theValue").each(function(){
			_tArrayValue.push($(this).val());
			//console.log($(this).val());
		});
		
		for (var i=0;i<_tArrayName.length;i++){
			_tNewArray.push({theName:_tArrayName[i],theLink:_tArrayValue[i],theDescr:''});		
		}
		console.log(_listname);
		console.log(_tNewArray);
		
		
		
	});
	*/
	
	
	
	
    $( "#"+_listname ).sortable({
      placeholder: "ui-state-highlight"
    });
	$( "#"+_listname ).on( "sortstop", function( event, ui ) {
		
		_tArrayName = [];
		_tArrayValue = [];
		_tNewArray = eval(_listname) ;
		_tNewArray.length = 0;
		 
		console.log(_listname);	
		$("#"+_listname).find(".theName").each(function(){
			_tArrayName.push($(this).val());
			//console.log($(this).val());
		});
		$("#"+_listname).find(".theValue").each(function(){
			_tArrayValue.push($(this).val());
			//console.log($(this).val());
		});
		
		for (var i=0;i<_tArrayName.length;i++){
			_tNewArray.push({theName:_tArrayName[i],theLink:_tArrayValue[i],theDescr:''});		
		}
		
		
	} );
   
   //$( "#sortable" ).disableSelection();



}



function loadLocal(){
	console.log("LOADING FROM LOCAL OBJECT");
	if (localStorage.getItem("xmlConfiguration")){
		parseXML(localStorage.getItem("xmlConfiguration"));
	}
	else{
		console.log("NO LOCAL STORAGE FILE FOUND");	
	}
}


function saveLocal(_XML){
	console.log("SAVING TO LOCAL OBJECT");
	localStorage.setItem("xmlConfiguration", _XML);
}





</script>
<!--<script src="../js/productfinder_mo.js" type="text/javascript"></script>-->







</body>
</html>
